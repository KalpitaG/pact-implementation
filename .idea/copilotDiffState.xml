<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/tests/provider.verify.test.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/tests/provider.verify.test.js" />
              <option name="originalContent" value="// tests/provider.verify.test.js&#10;import { Verifier } from &quot;@pact-foundation/pact&quot;;&#10;import { beforeAll, afterAll, test } from &quot;@jest/globals&quot;;&#10;import app, { resetData } from &quot;../src/provider.js&quot;; //  Express app + helper&#10;&#10;const PORT = 3000;&#10;const baseUrl = `http://localhost:${PORT}`;&#10;let server;&#10;&#10;beforeAll(async () =&gt; {&#10;    // Start real provider API&#10;    resetData(); // ensure a known starting state (ids 1 &amp; 2 exist)&#10;    await new Promise((resolve) =&gt; { server = app.listen(PORT, resolve); });&#10;});&#10;&#10;afterAll(async () =&gt; {&#10;    // Cleanly stop the server so Jest exits&#10;    await new Promise((resolve) =&gt; server.close(resolve));&#10;});&#10;&#10;test(&#10;    &quot;verifies provider against consumer contracts&quot;,&#10;    async () =&gt; {&#10;        // Check if Pact Broker environment variables are set&#10;        if (!process.env.PACT_BROKER_BASE_URL || !process.env.PACT_BROKER_TOKEN) {&#10;            throw new Error(&#10;                &quot;Missing Pact Broker environment variables. Please set:\n&quot; +&#10;                &quot;PACT_BROKER_BASE_URL=https://your-workspace.pactflow.io\n&quot; +&#10;                &quot;PACT_BROKER_TOKEN=your-read-write-token&quot;&#10;            );&#10;        }&#10;&#10;        const opts = {&#10;            // MUST match the names in your pact JSON generated by your tests:&#10;            // consumer: 'ItemsConsumer', provider: 'ItemsCrudAPI'&#10;            provider: &quot;ItemsCrudAPI&quot;,&#10;            providerBaseUrl: baseUrl,&#10;&#10;            // Choose ONE of the following two sources for contracts:&#10;&#10;            // (A) From a Broker (PactFlow / self-hosted)&#10;           // pactBrokerUrl: process.env.PACT_BROKER_BASE_URL,      // e.g. https://&lt;workspace&gt;.pactflow.io&#10;           // pactBrokerToken: process.env.PACT_BROKER_TOKEN,       // read/write token&#10;           // consumerVersionSelectors: [{ tag: &quot;main&quot;, latest: true }], // match how you published&#10;&#10;            // (B) Or from a local pact file (uncomment to use local file instead of a broker)&#10;             pactUrls: [&quot;./pacts/ItemsConsumer-ItemsCrudAPI.json&quot;],&#10;&#10;            // Publish verification result back to the Broker (ignored if using pactUrls)&#10;            //publishVerificationResult: true,&#10;            //providerVersion: &quot;1.0.0&quot;,&#10;&#10;            // Provider States: keys MUST EXACTLY match your .given(&quot;...&quot;) strings&#10;            stateHandlers: {&#10;                // Your default resetData() already satisfies these:&#10;                &quot;items exist&quot;: async () =&gt; { resetData(); },&#10;&#10;                &quot;the item for that id exists&quot;: async () =&gt; { resetData(); },&#10;                &quot;an item with that id exists and can be replaced&quot;: async () =&gt; { resetData(); },&#10;&#10;                // For “does not exist” we also just reset (ids are 1 &amp; 2 only)&#10;                &quot;an item does not exist for the specified id&quot;: async () =&gt; { resetData(); },&#10;&#10;                // Validation scenarios typically need no data setup:&#10;                &quot;a name is provided for the item that needs to be added&quot;: async () =&gt; {},&#10;                &quot;no name is given when a new item is created&quot;: async () =&gt; {},&#10;            },&#10;&#10;            // If provider needed auth headers during verification, inject them here:&#10;            // requestFilter: (req, res, next) =&gt; {&#10;            //   req.headers[&quot;authorization&quot;] = &quot;Bearer testtoken&quot;;&#10;            //   next();&#10;            // },&#10;        };&#10;&#10;        await new Verifier(opts).verifyProvider();&#10;    },&#10;    60_000 // give the verifier time&#10;);&#10;" />
              <option name="updatedContent" value="// tests/provider.verify.test.js&#10;import { Verifier } from &quot;@pact-foundation/pact&quot;;&#10;import { beforeAll, afterAll, test } from &quot;@jest/globals&quot;;&#10;import app, { resetData } from &quot;../src/provider.js&quot;; //  Express app + helper&#10;&#10;const PORT = 3000;&#10;const baseUrl = `http://localhost:${PORT}`;&#10;let server;&#10;&#10;beforeAll(async () =&gt; {&#10;    // Start real provider API&#10;    resetData(); // ensure a known starting state (ids 1 &amp; 2 exist)&#10;    await new Promise((resolve) =&gt; { server = app.listen(PORT, resolve); });&#10;});&#10;&#10;afterAll(async () =&gt; {&#10;    // Cleanly stop the server so Jest exits&#10;    await new Promise((resolve) =&gt; server.close(resolve));&#10;});&#10;&#10;test(&#10;    &quot;verifies provider against consumer contracts&quot;,&#10;    async () =&gt; {&#10;        // Check if Pact Broker environment variables are set&#10;        if (!process.env.PACT_BROKER_BASE_URL || !process.env.PACT_BROKER_TOKEN) {&#10;            throw new Error(&#10;                &quot;Missing Pact Broker environment variables. Please set:\n&quot; +&#10;                &quot;PACT_BROKER_BASE_URL=https://your-workspace.pactflow.io\n&quot; +&#10;                &quot;PACT_BROKER_TOKEN=your-read-write-token&quot;&#10;            );&#10;        }&#10;&#10;        const opts = {&#10;            // MUST match the names in your pact JSON generated by your tests:&#10;            // consumer: 'ItemsConsumer', provider: 'ItemsCrudAPI'&#10;            provider: &quot;ItemsCrudAPI&quot;,&#10;            providerBaseUrl: baseUrl,&#10;&#10;            // Choose ONE of the following two sources for contracts:&#10;&#10;            // (A) From a Broker (PactFlow / self-hosted)&#10;           // pactBrokerUrl: process.env.PACT_BROKER_BASE_URL,      // e.g. https://&lt;workspace&gt;.pactflow.io&#10;           // pactBrokerToken: process.env.PACT_BROKER_TOKEN,       // read/write token&#10;           // consumerVersionSelectors: [{ tag: &quot;main&quot;, latest: true }], // match how you published&#10;&#10;            // (B) Or from a local pact file (uncomment to use local file instead of a broker)&#10;             pactUrls: [&quot;./pacts/ItemsConsumer-ItemsCrudAPI.json&quot;],&#10;&#10;            // Publish verification result back to the Broker (ignored if using pactUrls)&#10;            //publishVerificationResult: true,&#10;            //providerVersion: &quot;1.0.0&quot;,&#10;&#10;            // Provider States: keys MUST EXACTLY match your .given(&quot;...&quot;) strings&#10;            stateHandlers: {&#10;                // Your default resetData() already satisfies these:&#10;                &quot;items exist&quot;: async () =&gt; { resetData(); },&#10;&#10;                &quot;the item for that id exists&quot;: async () =&gt; { resetData(); },&#10;                &quot;an item with that id exists and can be replaced&quot;: async () =&gt; { resetData(); },&#10;&#10;                // For “does not exist” we also just reset (ids are 1 &amp; 2 only)&#10;                &quot;an item does not exist for the specified id&quot;: async () =&gt; { resetData(); },&#10;&#10;                // Validation scenarios typically need no data setup:&#10;                &quot;a name is provided for the item that needs to be added&quot;: async () =&gt; {},&#10;                &quot;no name is given when a new item is created&quot;: async () =&gt; {},&#10;            },&#10;&#10;            // If provider needed auth headers during verification, inject them here:&#10;            // requestFilter: (req, res, next) =&gt; {&#10;            //   req.headers[&quot;authorization&quot;] = &quot;Bearer testtoken&quot;;&#10;            //   next();&#10;            // },&#10;        };&#10;&#10;        await new Verifier(opts).verifyProvider();&#10;    },&#10;    60_000 // give the verifier time&#10;);" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>